<!DOCTYPE html>
<html lang="in">

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Chat</title>
    <style>
         * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .chat-container {
      width: 100%;
      height: 100vh;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      background-color: #f5f5f5;
    }

    .chat-header {
      background-color: #151515;
      color: #fff;
      width: 100%;
      padding: 10px;
      text-align: center;
    }

    .chat-header h2 {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .chat-header h2 i {
      margin-right: 0px;
    }

    .chat-messages {
      width: 100%;
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
      background-color: #f5f5f5;
    }

    .message {
      margin-bottom: 10px;
      display: flex;
      align-items: flex-start;
    }

    .message .sender {
      font-weight: bold;
      margin-right: 5px;
    }

    .message .text {
      background-color: #fff;
      padding: 8px;
      border-radius: 10px;
    }

    .message .time {
      font-size: 0.8em;
      color: #888;
      margin-left: 5px;
    }

    .chat-input {
      width: 100%;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      background-color: #252828;
    }

    .input-row {
      display: flex;
      align-items: center;
      width: 100%;
      margin-bottom: 5px;
    }

    .input-row input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-right: 5px;
    }

    .input-row button {
      padding: 8px 15px;
      background-color: #128c7e;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .input-row button:hover {
      background-color: #075e54;
    }

    .navigation {
      display: flex;
      justify-content: center;
      margin-top: 0px;
    }

    .navigation button {
      padding: 10px 30px;
      background-color: #1eb6a7;
      color: #000000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin: 5px;
      font-size: 15px;
      border: 1.5px solid #eaeafff0;
      box-shadow: 0 8px 16px rgba(18, 140, 126, 0.2); /* Menambah ketebalan bayangan */ } 


   

    .navigation button:hover {
      background-color: #075e54;
    }

    .floating-button {
      position: fixed;
      bottom: 170px;
      right: 10px;
      width: 50px;
      height: 50px;
      background-color: #128c7e;
      color: #fff;
      border-radius: 50%;
      text-align: center;
      font-size: 28px;
      line-height: 50px;
      cursor: pointer;
      z-index: 999;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    .floating-button:hover {
      transform: translateY(-10px) rotate(20deg) scale(1.2);
      transform: scale(1.1) rotate(45deg);
      background-color: #075e54;
    }

    .floating-button:active {
      transform: translateY(-5px) rotate(10deg) scale(1.1);
    }

  
    
    @keyframes color-change {
  0% { color:#66ff2b; }
  25% { color:#ffe795; }
  50% { color: #ff2b5f; }
  75% { color:#bfffff; }
  100% { color:#5558ff; }
}

#back-link {
    text-decoration: none;
    color: #ffffff;
    font-size: 25px;
    margin: 10px;
    position: fixed;
    top: 20px;
    left: 10px;
}

  </style>
 
 
</head>

<body>
  <div class="chat-container">
    <div class="chat-header">
        <h2 style="display: flex; align-items: center;">
            <a id="back-link" href="javascript:history.back()"><i class="fas fa-arrow-left"></i> </a>
            
  <img src="https://i.ibb.co/N1SvnSk/Logopit-1685801091305.png" alt="Group Icon" style="width: 36px; height: 36px; margin-right: 5px;">
  <span style="animation: color-change 1.2s infinite;">Live chat</span>
</h2>
<hr style="width: 100%; height:2px; background-color: white;">
      <nav class="navigation">
        <button id="about-button">About</button>
        <button id="contact-button">Developer</button>
        <button id="Donasi-button">Donasi</button>
      </nav>
    </div>
   
    <div class="chat-messages" id="chat-messages">
      <!-- tempat untuk menampilkan pesan-pesan chat -->
    </div>
     
    <div class="chat-input">
      <input type="text" id="username-input" placeholder="Nama Pengguna"
        style="width: 74%; padding: 20px; border: none; border-radius: 5px; margin-bottom: 10px;">
      <div class="input-row">
        <input type="text" id="message-input" placeholder="Ketik pesan..."
          style="flex: 1; padding: 20px; border: 1px solid #ddd; border-radius: 5px; margin-right: 5px;">
        &nbsp &nbsp <button id="send-button"
          style="padding: 18px 25px; background-color: #128c7e; color: #fff; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s;">Kirim</button>
      </div>
    </div>
  </div>

  <div class="floating-button" id="scroll-top-button">&uarr;</div>

    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.29.3.min.js"></script>
    <script>
    var pubnub = new PubNub({
        publishKey: 'pub-c-d4703e7a-1c77-4020-88f7-57cec93642d4',
        subscribeKey: 'sub-c-f4c87778-0631-408f-8343-8f18a7d9720f'
    });

    var chatMessages = document.getElementById('chat-messages');
    var usernameInput = document.getElementById('username-input');
    var messageInput = document.getElementById('message-input');
    var sendButton = document.getElementById('send-button');
    var homeButton = document.getElementById('home-button');
    var aboutButton = document.getElementById('about-button');
    var contactButton = document.getElementById('contact-button');
    var DonasiButton = document.getElementById('Donasi-button');
    var scrollTopButton = 
    document.getElementById('scroll-top-button');

    sendButton.addEventListener('click', function () {
        var username = usernameInput.value;
        var message = messageInput.value;
        if (username.trim() !== '' && message.trim() !== '') {
            if (message.startsWith('/hapus')) {
                clearChatMessages();
            } else if (message.startsWith('/gantiwarna')) {
                var color = message.split(' ')[1];
                changeChatColor(color);
            }  else if (message.startsWith('/notes')) {
                showHelp();
            } else if (message.startsWith('/info')) {
                showStatistics();
            } else if (message.startsWith('/tebak')) {
                var number = parseInt(message.split(' ')[1]);
                if (!isNaN(number)) {
                    guessNumber(number);
                } else {
                    sendMessage('Bot', 'Mohon masukkan angka yang valid.');
                }
  } 
  else if (message.startsWith('/user_admin')) {
    var adminCommand = message.substring('/user_admin'.length).trim();
    if (adminCommand !== '') {
      sendAdminMessage(adminCommand);
    }
  } else if (message.startsWith('/penjumlahan')) {
    var numbers = message.split(' ').slice(1);
    var sum = calculateSum(numbers);
    sendMessage('Bot', 'Hasil penjumlahan: ' + sum);
  } else if (message.startsWith('/perkalian')) {
    var numbers = message.split(' ').slice(1);
    var product = calculateProduct(numbers);
    sendMessage('Bot', 'Hasil perkalian: ' + product);
  } else if (message.startsWith('/pembagian')) {
    var numbers = message.split(' ').slice(1);
    var quotient = calculateQuotient(numbers);
    sendMessage('Bot', 'Hasil pembagian: ' + quotient);
  } else if (message.startsWith('/random-text')) {
    var joke = generateJoke();
    sendMessage('Bot', joke);
  } else if (message.startsWith('/privasi')) {
    var secretMessage = message.substring('/privasi'.length).trim();
    var encryptedMessage = encryptMessage(secretMessage, 3); // Menggunakan metode Caesar Cipher dengan pergeseran 3
    sendMessage('Bot', 'Pesan terenkripsi: ' + encryptedMessage);
  } else if (message.startsWith('/terjemahkan')) {
    var encryptedMessage = message.substring('/terjemahkan'.length).trim();
    var decryptedMessage = decryptMessage(encryptedMessage, 3); // Menggunakan metode Caesar Cipher dengan pergeseran 3
    sendMessage('Bot', 'Pesan terjemahan: ' + decryptedMessage);
  } else {
    sendMessage(username, message);
  }
  messageInput.value = '';
}

// Fungsi untuk mengenkripsi pesan dengan Caesar Cipher
function encryptMessage(message, shift) {
  var encryptedMessage = '';
  for (var i = 0; i < message.length; i++) {
    var charCode = message.charCodeAt(i);
    if (charCode >= 65 && charCode <= 90) { // Huruf besar
      encryptedMessage += String.fromCharCode((charCode - 65 + shift) % 26 + 65);
    } else if (charCode >= 97 && charCode <= 122) { // Huruf kecil
      encryptedMessage += String.fromCharCode((charCode - 97 + shift) % 26 + 97);
    } else {
      encryptedMessage += message.charAt(i);
    }
  }
  return encryptedMessage;
}

// Fungsi untuk mendekripsi pesan dengan Caesar Cipher
function decryptMessage(message, shift) {
  var decryptedMessage = '';
  for (var i = 0; i < message.length; i++) {
    var charCode = message.charCodeAt(i);
    if (charCode >= 65 && charCode <= 90) { // Huruf besar
      decryptedMessage += String.fromCharCode((charCode - 65 - shift + 26) % 26 + 65);
    } else if (charCode >= 97 && charCode <= 122) { // Huruf kecil
      decryptedMessage += String.fromCharCode((charCode - 97 - shift + 26) % 26 + 97);
    } else {
      decryptedMessage += message.charAt(i);
    }
  }
  return decryptedMessage;
}
    });

    pubnub.subscribe({
        channels: ['live-chat-channel']
    });

    pubnub.addListener({
  message: function (message) {
    var messageData = message.message;
    var sender = messageData.sender;
    var text = messageData.text;

    var messageElement = document.createElement('div');
    messageElement.className = 'message';

    var senderElement = document.createElement('span');
    senderElement.className = 'sender';
    senderElement.textContent = sender;

    var textElement = document.createElement('span');
    textElement.className = 'text';
    textElement.textContent = text;

    var timeElement = document.createElement('span');
    timeElement.className = 'time';
    timeElement.textContent = getCurrentTime();

    messageElement.appendChild(senderElement);
    messageElement.appendChild(textElement);
    messageElement.appendChild(timeElement);

    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // Simpan histori chat ke localStorage
    var chatHistory = localStorage.getItem('chatHistory');
    if (chatHistory) {
      chatHistory = JSON.parse(chatHistory);
    } else {
      chatHistory = [];
    }

    chatHistory.push({
      sender: sender,
      text: text,
      time: getCurrentTime()
    });

    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
  }
});

// Memuat histori chat dari localStorage saat halaman dimuat
// Memuat histori chat dari localStorage saat halaman dimuat
window.addEventListener('load', function () {
  var chatHistory = localStorage.getItem('chatHistory');
  if (chatHistory) {
    chatHistory = JSON.parse(chatHistory);
    for (var i = 0; i < chatHistory.length; i++) {
      var messageData = chatHistory[i];
      var sender = messageData.sender;
      var text = messageData.text;
      var time = messageData.time;

      // Cek apakah pesan sudah ada dalam histori chat
      var existingMessage = document.querySelector('.message[data-sender="' + sender + '"][data-text="' + text + '"]');
      if (existingMessage) {
        continue; // Pesan sudah ada, lanjutkan ke pesan berikutnya
      }

      var messageElement = document.createElement('div');
      messageElement.className = 'message';
      messageElement.setAttribute('data-sender', sender); // Tambahkan atribut data-sender
      messageElement.setAttribute('data-text', text); // Tambahkan atribut data-text

      var senderElement = document.createElement('span');
      senderElement.className = 'sender';
      senderElement.textContent = sender;

      var textElement = document.createElement('span');
      textElement.className = 'text';
      textElement.textContent = text;

      var timeElement = document.createElement('span');
      timeElement.className = 'time';
      timeElement.textContent = time;

      messageElement.appendChild(senderElement);
      messageElement.appendChild(textElement);
      messageElement.appendChild(timeElement);

      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  }
});


    aboutButton.addEventListener('click', function () {
        window.location.href = 'about.html';
    });

    contactButton.addEventListener('click', function () {
        window.location.href = 'Developer.html';
    });
    DonasiButton.addEventListener('click', function () {
        window.location.href = 'https://saweria.co/ehe79';
    });

    scrollTopButton.addEventListener('click', function () {
        chatMessages.scrollTop = 0;
    });

    function getCurrentTime() {
        var date = new Date();
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();

        if (hours < 10) {
            hours = '0' + hours;
        }

        if (minutes < 10) {
            minutes = '0' + minutes;
        }

        if (seconds < 10) {
            seconds = '0' + seconds;
        }

        return hours + ':' + minutes + ':' + seconds;
    }

    function clearChatMessages() {
        while (chatMessages.firstChild) {
            chatMessages.firstChild.remove();
        }
    }

    function changeChatColor(color) {
        chatMessages.style.backgroundColor = color;
    }

    function changeUsername(newName) {
        usernameInput.value = newName;
    }

    function changeGroup(newGroup) {
        // implement logic to change the group
        // based on your requirements
        console.log('Changing group to ' + newGroup);
    }

    function showHelp() {
        var helpMessage = "Command yang tersedia: \n\n" +
            "/hapus - Menghapus semua pesan di chat\n" +
            "/gantiwarna [warna] - Mengganti warna latar belakang chat\n" +
            
            "/notes - Menampilkan pesan bantuan ini\n" +
            "/info - Menampilkan jumlah pesan di chat\n" +
            "/tebak [angka] - Menebak angka\n" +
            
            "/user_admin [command] - Mengirim perintah administratif\n" +
            "/penjumlahan [angka1] [angka2]  Menjumlahkan angka-angka\n" +
            "/perkalian [angka1] [angka2] l Mengalikan angka-angka\n" +
            "/pembagian [angka1] [angka2]  Membagi angka-angka\n" +
            "/privasi pesan akan di ubah menjadi privasi\n" +
             "/terjemahkan pesan privasi akan diterjemahkan\n" +
            "/random-text- Menampilkan lawakan acak";

        alert(helpMessage);
    }

    function showStatistics() {
        var messagesCount = chatMessages.childElementCount;
        alert('Jumlah pesan di chat: ' + messagesCount);
    }

    function guessNumber(number) {
        var randomNumber = Math.floor(Math.random() * 10) + 1;
        var resultMessage;

        if (number === randomNumber) {
            resultMessage = 'Selamat! Anda menebak dengan benar.';
        } else {
            resultMessage = 'Maaf, tebakan Anda salah. Angka yang benar adalah ' + randomNumber + '.';
        }

        pubnub.publish({
            channel: 'live-chat-channel',
            message: {
                sender: 'Bot',
                text: resultMessage
            }
        });
    }

    function sendAdminMessage(command) {
        pubnub.publish({
            channel: 'live-chat-channel',
            message: {
                sender: 'Admin',
                text: command
            }
        });
    }

    function changeLanguage(targetLanguage, targetText) {
        // Implement logic to change the text to the target language
        // based on your requirements
        var translatedText = translateText(targetText, targetLanguage);
        if (translatedText) {
            pubnub.publish({
                channel: 'live-chat-channel',
                message: {
                    sender: 'Bot',
                    text: translatedText
                }
            });
        } else {
            pubnub.publish({
                channel: 'live-chat-channel',
                message: {
                    sender: 'Bot',
                    text: 'Terjadi kesalahan saat menerjemahkan teks.'
                }
            });
        }
    }

    function translateText(text, targetLanguage) {
        // Implement logic to translate the text to the target language
        // based on your requirements
        // You can use translation APIs or libraries to achieve this functionality
        // Here's a sample implementation using the Google Translate API
        // Make sure you have the necessary API credentials and replace YOUR_API_KEY with your actual API key
        var apiKey = 'YOUR_API_KEY';
        var apiUrl = 'https://translation.googleapis.com/language/translate/v2?key=' + apiKey;

        var requestBody = {
            q: text,
            target: targetLanguage
        };

        // Send a POST request to the translation API
        var request = new XMLHttpRequest();
        request.open('POST', apiUrl, false); // Synchronous request for simplicity
        request.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
        request.send(JSON.stringify(requestBody));

        if (request.status === 200) {
            var response = JSON.parse(request.responseText);
            if (response && response.data && response.data.translations && response.data.translations.length > 0) {
                return response.data.translations[0].translatedText;
            }
        }

        return null;
    }

    function calculateSum(numbers) {
        if (numbers.length === 0) {
            return 'Mohon masukkan angka yang valid.';
        }

        var sum = 0;
        for (var i = 0; i < numbers.length; i++) {
            var number = parseInt(numbers[i]);
            if (!isNaN(number)) {
                sum += number;
            }
        }

        return 'Hasil penjumlahan: ' + sum;
    }

    function calculateProduct(numbers) {
        if (numbers.length === 0) {
            return 'Mohon masukkan angka yang valid.';
        }

        var product = 1;
        for (var i = 0; i < numbers.length; i++) {
            var number = parseInt(numbers[i]);
            if (!isNaN(number)) {
                product *= number;
            }
        }

        return 'Hasil perkalian: ' + product;
    }

    function calculateQuotient(numbers) {
        if (numbers.length === 0) {
            return 'Mohon masukkan angka yang valid.';
        }

        var dividend = parseInt(numbers[0]);
        if (isNaN(dividend)) {
            return 'Mohon masukkan angka yang valid.';
        }

        for (var i = 1; i < numbers.length; i++) {
            var divisor = parseInt(numbers[i]);
            if (!isNaN(divisor) && divisor !== 0) {
                dividend /= divisor;
            }
        }

        return 'Hasil pembagian: ' + dividend;
    }

    function generateJoke() {
        var jokes = [
            'Apa yang Anda sebut beruang tanpa gigi? Seekor beruang bergetah!',
            'Mengapa orang-orangan sawah memenangkan penghargaan? Karena dia luar biasa di bidangnya!',
            'Mengapa para ilmuwan tidak mempercayai atom? Karena mereka membuat segalanya!',
            'Apa yang Anda dapatkan saat melewati manusia salju dan vampir? Radang dingin!',
            'Bagaimana seekor penguin membangun rumahnya? Igloo bersama-sama!',
            'Mengapa kerangka tidak saling bertarung? Mereka tidak punya nyali!',
            'Apa yang dikatakan satu dinding ke dinding lainnya? Aku akan menemuimu di sudut!',
            'Mengapa sepeda itu jatuh? Karena itu dua-lelah!',
          'Apa yang dikatakan satu topi ke topi lainnya? Anda tinggal di sini, saya akan melanjutkan!',
            'Apa yang Anda sebut bumerang yang tidak akan kembali? Sebuah tongkat!',
            'Mengapa buku matematika merasa sedih? Karena mereka memiliki banyak masalah!',
            'Mengapa orang-orang di kapal selam selalu tertawa? Karena mereka mendengar lelucon yang dalam!',
    'Mengapa burung tidak pernah menjadi penyanyi terkenal? Karena mereka selalu mencari sarang!',             
                   ];
                   
        var randomIndex = Math.floor(Math.random() * jokes.length);
        return jokes[randomIndex];
    }

    function sendMessage(sender, text) {
        pubnub.publish({
            channel: 'live-chat-channel',
            message: {
                sender: sender,
                text: text
            }
        });
    }
    // Fungsi untuk menyimpan pesan ke penyimpanan lokal
function saveMessageToLocalStorage(sender, text) {
    var messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
    var message = {
        sender: sender,
        text: text
    };
    messages.push(message);
    localStorage.setItem('chatMessages', JSON.stringify(messages));
}

// Fungsi untuk memuat pesan dari penyimpanan lokal saat halaman dimuat
function loadMessagesFromLocalStorage() {
    var messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
    messages.forEach(function (message) {
        var sender = message.sender;
        var text = message.text;
        var messageElement = createMessageElement(sender, text);
        chatMessages.appendChild(messageElement);
    });
}

// ...

// Modifikasi fungsi sendMessage untuk menyimpan pesan ke penyimpanan lokal sebelum mengirimnya
function sendMessage(sender, text) {
    saveMessageToLocalStorage(sender, text);

    pubnub.publish({
        channel: 'live-chat-channel',
        message: {
            sender: sender,
            text: text
        }
    });
}

</script>


</body>

</html>
